<% trip_color = @trip.color.presence || "#e5e7eb" %>
<div class="trip-detail-page" style="max-width: 960px; margin: 0 auto; padding: 24px 16px 40px;">
  <div style="margin-bottom: 12px;">
    <%= link_to "← 一覧に戻る", trips_path, style: "color: #2563eb; text-decoration: none; font-size: 14px; font-weight: 600;" %>
  </div>

  <div style="background: #fff; border: 1px solid #e5e7eb; border-radius: 20px; padding: 20px; box-shadow: 0 6px 16px rgba(0, 0, 0, 0.04); margin-bottom: 18px;">
    <div style="height: 6px; border-radius: 9999px; background: linear-gradient(135deg, <%= trip_color %> 0%, #f3f4f6 100%); margin-bottom: 14px;"></div>
    <div style="display: flex; gap: 16px; align-items: flex-start; justify-content: space-between; flex-wrap: wrap;">
      <div>
        <h1 style="font-size: 28px; font-weight: 800; color: #111827; margin: 0 0 6px;"><%= @trip.title %></h1>
        <p style="font-size: 16px; color: #6b7280; margin: 0 0 4px;">目的地: <span style="color: #111827; font-weight: 600;"><%= @trip.destination.presence || "未設定" %></span></p>
        <p style="font-size: 14px; color: #6b7280; margin: 0;">期間: <span style="color: #111827;"><%= [@trip.start_date&.strftime("%Y/%m/%d"), @trip.end_date&.strftime("%Y/%m/%d")].compact.join(" 〜 ") %></span></p>
      </div>
      <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
        <%= link_to "編集", edit_trip_path(@trip), style: [
          "padding: 8px 12px",
          "border-radius: 12px",
          "border: 1px solid #e5e7eb",
          "background: #f3f4f6",
          "color: #374151",
          "font-size: 14px",
          "font-weight: 600",
          "text-decoration: none"
        ].join('; ') %>

        <%= button_to "削除", trip_path(@trip), method: :delete,
          data: { turbo_confirm: "この旅行を削除しますか？" },
          form: { style: "margin: 0;" },
          style: [
            "padding: 8px 12px",
            "border-radius: 12px",
            "border: 1px solid #fecaca",
            "background: #fef2f2",
            "color: #dc2626",
            "font-size: 14px",
            "font-weight: 700",
            "cursor: pointer"
          ].join('; ') %>
      </div>
    </div>
  </div>

  <% default_tab = @default_tab.presence || "itinerary" %>
  <% tab_active_style = [
    "padding: 10px 16px",
    "border-radius: 16px",
    "font-size: 14px",
    "font-weight: 700",
    "border: 1px solid #e5e7eb",
    "color: #111827",
    "background: #ffffff",
    "box-shadow: 0 2px 8px rgba(0,0,0,0.08)",
    "cursor: pointer"
  ].join('; ') %>
  <% tab_inactive_style = [
    "padding: 10px 16px",
    "border-radius: 16px",
    "font-size: 14px",
    "font-weight: 600",
    "border: 1px solid transparent",
    "color: #6b7280",
    "background: transparent",
    "cursor: pointer"
  ].join('; ') %>

  <% panel_style = "background: #ffffff; border: 1px solid #e5e7eb; border-radius: 20px; padding: 18px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);" %>

  <div data-controller="tabs" data-tabs-default="<%= default_tab %>" style="margin-top: 20px;">
    <div role="tablist" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 8px; padding: 6px; background: #f3f4f6; border-radius: 18px; border: 1px solid #e5e7eb; margin: 0 0 16px;">
      <button type="button"
        id="tab-itinerary"
        role="tab"
        aria-selected="true"
        aria-controls="tab-panel-itinerary"
        tabindex="0"
        data-action="tabs#switch"
        data-tabs-target="tab"
        data-tab-id="itinerary"
        data-tabs-id-param="itinerary"
        data-tabs-active-style="<%= tab_active_style %>"
        data-tabs-inactive-style="<%= tab_inactive_style %>"
        style="<%= tab_active_style %>">旅程</button>
      <button type="button"
        id="tab-packing"
        role="tab"
        aria-selected="false"
        aria-controls="tab-panel-packing"
        tabindex="-1"
        data-action="tabs#switch"
        data-tabs-target="tab"
        data-tab-id="packing"
        data-tabs-id-param="packing"
        data-tabs-active-style="<%= tab_active_style %>"
        data-tabs-inactive-style="<%= tab_inactive_style %>"
        style="<%= tab_inactive_style %>">持ち物</button>
      <button type="button"
        id="tab-memo"
        role="tab"
        aria-selected="false"
        aria-controls="tab-panel-memo"
        tabindex="-1"
        data-action="tabs#switch"
        data-tabs-target="tab"
        data-tab-id="memo"
        data-tabs-id-param="memo"
        data-tabs-active-style="<%= tab_active_style %>"
        data-tabs-inactive-style="<%= tab_inactive_style %>"
        style="<%= tab_inactive_style %>">メモ</button>
    </div>

    <div role="tabpanel" id="tab-panel-itinerary" aria-labelledby="tab-itinerary" data-tabs-target="panel" data-tab-id="itinerary" style="<%= panel_style %>">
      <div style="display: grid; gap: 14px;">
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap;">
          <h2 style="font-size: 20px; font-weight: 800; color: #111827; margin: 0;">旅程</h2>
          <%= link_to "＋ 活動を追加", new_trip_activity_path(@trip), style: [
            "padding: 10px 14px",
            "border-radius: 12px",
            "border: none",
            "background: #3b82f6",
            "color: #ffffff",
            "font-size: 14px",
            "font-weight: 700",
            "text-decoration: none",
            "box-shadow: 0 6px 16px rgba(59,130,246,0.2)"
          ].join('; ') %>
        </div>
        <% if @activities.present? %>
          <div style="display: grid; gap: 12px;">
            <%= render @activities %>
          </div>
        <% else %>
          <div style="border: 1px dashed #d1d5db; border-radius: 18px; padding: 20px; background: #f9fafb; text-align: center;">
            <p style="margin: 0 0 6px; font-size: 16px; font-weight: 700; color: #111827;">まだ旅程がありません</p>
            <p style="margin: 0; font-size: 13px; color: #6b7280;">予定を追加するとここに表示されます。</p>
          </div>
        <% end %>
      </div>
    </div>

    <div role="tabpanel" id="tab-panel-packing" aria-labelledby="tab-packing" data-tabs-target="panel" data-tab-id="packing" style="<%= panel_style %>">
      <div style="display: grid; gap: 14px;">
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap;">
          <h2 style="font-size: 20px; font-weight: 800; color: #111827; margin: 0;">持ち物</h2>
        </div>
        <div style="border: 1px solid #e5e7eb; border-radius: 16px; padding: 12px; background: #f9fafb;">
          <%= render "packing_items/inline_form", trip: @trip, packing_item: @packing_item || @trip.packing_items.build %>
        </div>
        <% if @packing_items.present? %>
          <div style="display: grid; gap: 10px;">
            <%= render @packing_items %>
          </div>
        <% else %>
          <div style="border: 1px dashed #d1d5db; border-radius: 18px; padding: 20px; background: #f9fafb; text-align: center;">
            <p style="margin: 0 0 6px; font-size: 16px; font-weight: 700; color: #111827;">まだ持ち物がありません</p>
            <p style="margin: 0; font-size: 13px; color: #6b7280;">追加するとここに表示されます。</p>
          </div>
        <% end %>
      </div>
    </div>

    <div role="tabpanel" id="tab-panel-memo" aria-labelledby="tab-memo" data-tabs-target="panel" data-tab-id="memo" style="<%= panel_style %>">
      <div style="display: grid; gap: 14px;">
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap;">
          <h2 style="font-size: 20px; font-weight: 800; color: #111827; margin: 0;">メモ</h2>
        </div>
        <%= form_with model: @trip, url: trip_path(@trip), method: :patch, html: { style: "display: grid; gap: 12px;" } do |form| %>
          <%= hidden_field_tag :source, "memo" %>
          <%= form.text_area :notes, rows: 6, placeholder: "フライト番号や予約メモなどを入力できます", style: "width: 100%; max-width: 100%; box-sizing: border-box; padding: 14px; border: 1px solid #d1d5db; border-radius: 16px; font-size: 15px; color: #111827; background: #fff; line-height: 1.6; resize: vertical; box-shadow: inset 0 1px 2px rgba(0,0,0,0.02);" %>
          <div style="display: flex; justify-content: flex-end;">
            <%= form.submit "保存する", style: "display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 12px 18px; background: #3b82f6; color: #fff; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 10px 25px rgba(59,130,246,0.2); width: 100%; max-width: 240px; transition: transform 0.08s ease, box-shadow 0.08s ease;", data: { turbo_submits_with: "保存中..." } %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
